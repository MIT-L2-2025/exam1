{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "jsCode": "const json = items[0].json;\nconst places = json.local_results || json.places || json.results || [];\nreturn places.map(place => ({ json: {\n  nom: place.title || place.name,\n  adresse: place.address || place.vicinity,\n  specialites: place.categories || place.types,\n  coordonnees: {\n    lat: place.gps_coordinates?.latitude,\n    lng: place.gps_coordinates?.longitude\n  },\n  photo_ref: place.photos?.[0]?.photo_reference || null,\n  contact: place.phone || place.formatted_phone_number || null\n}}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        180,
        -140
      ],
      "id": "d0fef69d-26b5-49c5-ad5b-895fda43c62f",
      "name": "Code"
    },
    {
      "parameters": {
        "html": "<!DOCTYPE html>\n\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>My HTML document</title>\n</head>\n<body>\n  <div class=\"container\">\n    <h1>This is an H1 heading</h1>\n    <h2>This is an H2 heading</h2>\n    <p>This is a paragraph</p>\n  </div>\n</body>\n</html>\n\n<style>\n.container {\n  background-color: #ffffff;\n  text-align: center;\n  padding: 16px;\n  border-radius: 8px;\n}\n\nh1 {\n  color: #ff6d5a;\n  font-size: 24px;\n  font-weight: bold;\n  padding: 8px;\n}\n\nh2 {\n  color: #909399;\n  font-size: 18px;\n  font-weight: bold;\n  padding: 8px;\n}\n</style>\n\n<script>\n  console.log(\"Hello World!\");\n</script>"
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        400,
        -140
      ],
      "id": "a9ca7c58-e098-4a4c-b6df-ac994c8a613f",
      "name": "HTML"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -260,
        -40
      ],
      "id": "81471e01-b683-4b84-9004-d457dca532e6",
      "name": "Start"
    },
    {
      "parameters": {
        "url": "https://www.searchapi.io/api/v1/search?engine=google_maps&q=Restaurants+chinois&location=Antananarivo+Madagascarl&ll=@-18.8792,47.5079,12z&api_key=on8ZHsbZqSRUkx653CTnqrA2",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -40,
        -140
      ],
      "id": "25e6fc2e-128c-4798-a8da-7ec594717a9a",
      "name": "Request on searchAPI"
    },
    {
      "parameters": {
        "url": "https://api.apify.com/v2/datasets/oadgYRWCp0mG1FAgw/items?format=json&clean=true",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -40,
        160
      ],
      "id": "20998ea3-ab2b-4407-8285-7a19f9b052f5",
      "name": "Request on apify"
    },
    {
      "parameters": {
        "jsCode": "return $input.all().map(item => {\n  const data = item.json;\n\n  return {\n    json: {\n      nom: data.title || \"Nom non disponible\",\n      lat: data.location?.lat || null,\n      lon: data.location?.lng || null,\n      source: \"aptify\",\n      address: data.address || null,\n      contact: data.phone || null,\n      lien_image3D: data.imageUrl || null,\n      specialité: data.categoryName || \"Spécialité non précisée\",\n      }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        180,
        160
      ],
      "id": "ba6dab10-ee75-43f9-b2c7-9e4c9fe14a1a",
      "name": "Code1"
    },
    {
      "parameters": {
        "jsCode": "const restaurants = $input.all().map(item => item.json);\n\nlet htmlContent = `\n<!DOCTYPE html>\n<html lang=\"fr\">\n<head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>Restaurants Chinois à Antananarivo</title>\n    <link href=\"https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <style>\n        body { font-family: 'Poppins', sans-serif; margin: 0; background: #f4f8fb; color: #333; }\n        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }\n        h1 { text-align: center; font-size: 2.8em; color: #2d3e50; font-weight: 600; margin-bottom: 40px; text-transform: uppercase; letter-spacing: 1px; }\n        .restaurant { background: #ffffff; border-radius: 20px; padding: 25px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); transition: transform .3s, box-shadow .3s; }\n        .restaurant:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); }\n        .restaurant h2 { color: #e91e63; font-size: 2.2em; margin-bottom: 15px; font-weight: 600; }\n        .restaurant p { margin: 10px 0; font-size: 1.1em; color: #555; line-height: 1.6; }\n        .restaurant p i { color: #00bcd4; margin-right: 12px; font-size: 1.3em; }\n        .restaurant img { width: 100%; height: auto; border-radius: 12px; margin-top: 20px; box-shadow: 0 3px 15px rgba(0,0,0,0.1); }\n        .route-button { display: inline-block; padding: 14px 28px; background: #ff5722; color: #fff; border: none; border-radius: 50px; font-size: 1.2em; text-align: center; transition: background .3s, transform .3s; }\n        .route-button:hover { background: #f44336; transform: translateY(-3px); }\n        .route-button:focus { outline: none; }\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }\n        @media (max-width: 768px) { .restaurant h2 { font-size: 1.8em; } .restaurant p { font-size: 1em; } }\n    </style>\n</head>\n<body>\n  <div class=\"container\">\n    <h1>Restaurants Chinois à Antananarivo</h1>\n`;\n\nrestaurants.forEach((r, i) => {\n  htmlContent += `\n    <div class=\"restaurant\">\n      <h2>${r.nom}</h2>\n      <p><i class=\"fas fa-map-marker-alt\"></i><strong>Adresse:</strong> ${r.address || 'Non renseignée'}</p>\n      <p><i class=\"fas fa-phone\"></i><strong>Contact:</strong> ${r.contact || 'Non renseigné'}</p>\n      <p><i class=\"fas fa-utensils\"></i><strong>Spécialité:</strong> ${r.specialité}</p>\n      ${r.lien_image3D ? `<img src=\"${r.lien_image3D}\" alt=\"Façade de ${r.nom}\" />` : ''}\n      <button class=\"route-button\" onclick=\"showRoute(${i})\"><i class=\"fas fa-route\"></i> Itinéraire</button>\n    </div>\n  `;\n});\n\nhtmlContent += `\n  </div>\n  <script>\n    const mapData = ${JSON.stringify(restaurants.map(r => ({ lat: r.lat, lng: r.lon, name: r.nom })))};\n    const maps = [], directionsRenderers = [];\n    function initMaps() {\n      mapData.forEach((d, i) => {\n        if (d.lat && d.lng) {\n          const map = new google.maps.Map(document.getElementById('map-' + i), {\n            center: { lat: d.lat, lng: d.lng }, zoom: 15\n          });\n          new google.maps.Marker({ position: { lat: d.lat, lng: d.lng }, map, title: d.name });\n          maps[i] = map;\n          directionsRenderers[i] = new google.maps.DirectionsRenderer({ map });\n        } else {\n          document.getElementById('map-' + i).style.display = 'none';\n        }\n      });\n    }\n    function showRoute(i) {\n      if (!maps[i] || !navigator.geolocation) return alert('Géolocalisation indisponible');\n      navigator.geolocation.getCurrentPosition(pos => {\n        const origin = { lat: pos.coords.latitude, lng: pos.coords.longitude };\n        const dest = { lat: mapData[i].lat, lng: mapData[i].lng };\n        new google.maps.DirectionsService().route({\n          origin, destination: dest, travelMode: 'DRIVING'\n        }, (res, status) => {\n          if (status === 'OK') directionsRenderers[i].setDirections(res);\n          else alert('Itinéraire impossible: ' + status);\n        });\n      }, err => alert('Erreur géoloc: ' + err.message));\n    }\n  </script>\n</body>\n</html>\n`;\n\nreturn [{\n  json: { fileName: 'restaurants.html' },\n  binary: {\n    data: {\n      data: Buffer.from(htmlContent).toString('base64'),\n      mimeType: 'text/html',\n      fileName: 'restaurants.html'\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        400,
        160
      ],
      "id": "53371255-4a81-424e-b800-cab855d86c93",
      "name": "Code2"
    }
  ],
  "pinData": {},
  "connections": {
    "Code": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Start": {
      "main": [
        [
          {
            "node": "Request on searchAPI",
            "type": "main",
            "index": 0
          },
          {
            "node": "Request on apify",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Request on searchAPI": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Request on apify": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML": {
      "main": [
        []
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f316219b-c962-4896-9195-691eaa308bab",
  "meta": {
    "instanceId": "619bc3e8229ccb1722f0b4322c7e6a45f9fc5efc5c0f274691c0eff47cdb6e95"
  },
  "id": "g9kIxNzsCrVLBXuQ",
  "tags": []
}